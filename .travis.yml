language: rust
sudo: false
env:
  global:
    project_name: git-fixup
install: ci/install.sh
script: ci/build.sh
addons:
  apt:
    packages:
      - zlib1g-dev
      - libcurl4-openssl-dev
      - libssl-dev
      - cmake
      - libelf-dev
      - libdw-dev
      - musl-tools
      - pkgconf
matrix:
  fast_finish: yes
  include:
    - os: linux
      rust: stable
      env: TARGET=i686-unknown-linux-musl
    - os: linux
      rust: stable
      env: TARGET=x86_64-unknown-linux-musl
    - os: linux
      rust: stable
      env: TARGET=x86_64-unknown-linux-gnu
    # - os: osx
    #   rust: stable
    #   env: TARGET=x86_64-apple-darwin
    # - os: linux
    #   rust: beta
    #   env: TARGET=x86_64-unknown-linux-gnu
    # - os: linux
    #   rust: nightly
    #   env: TARGET=x86_64-unknown-linux-gnu
before_deploy: ci/before_deploy.sh
deploy:
  provider: releases
  file_glob: yes
  file: deployment/${PROJECT_NAME}-${TRAVIS_TAG}-${TARGET}.tar.gz
  skip_cleanup: yes
  on:
    repo: quodlibetor/git-fixup
    branch: master
    tags: yes
  api_key:
    secure: hBOcDjVCykas3QyrWR/dMxG/kDkNXxyI6e7m32T2M058t8LtCe8qlr9QIMcwvwOw1Lf6e+UT7uGMBcgFN7w9AweTYA1fsE1NOw47s55VJpwKYB+4oiwuJJumeZfpbSDCBc6PIjCqG5cUWm0P6LWzpsTAXqqLmCesrbI3zqA1OQcsABoghrj8+X+629VSdLbIdzQJKe/iCG3GRq0xw9/wjQxZa6cO0AaSC5YbIIv2fLZUnnyxQ9SmbGvXCFyKkYpEVSeFMZYPvFqgu8a7HPKUOKZIfhwdlFakQGHs3ooztFan1LKy530Gmj7NMJqNVdW2uYt0x0PwEQ/F2YYnHrGE2Iq/zJ17qAMbtxCqEXnHiqA2olYGgldJA53aoY/lrXy8nZsDoT9UGcnE0AO0j7ol0aqZTKHpWTfb0sbp4UXaZn2kCFtlENeXpJ/kSHh/K/n1N2YRx/Rci2va2KZqLcKToQoK29jvGTGU/8Nxd0c9HbnH4snvzaAgxZxh2T1vD9ZC2MhebISW/mKjvAVC77yVJNWr1vKFgkZWmxzpOaq4cA0K82Hcde0crjX/uXjDS3vspk5MizQ3Q+YsmYzf/Kr/rgUccWLxGDTVvFNUf5/wMMqYR60DWveJwUuH4h7kd91Uqr2bSVnfgk9Iscs1IGsAOpqfuV8FMzZG6Ubq8O8WBgY=
